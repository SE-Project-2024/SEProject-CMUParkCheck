<%- include("../partials/header") %>
<div class="parking-complaint-text">
    <div class="parking-complaint">PARKING COMPLAINTS</div>
</div>
<div class="view-complaints-form">
    <button type="button" class="complaints-form" id="complaintsBtn">Report a Parking Issue</button>
</div>
<div class="status-filter">
    <select id="status-filter" name="status">
        <option value="all">All</option>
        <option value="resolved">Resolved</option>
        <option value="pending">Pending</option>
    </select>
</div>
<div class="search-track">
    <input type="text" class="track-num" placeholder="Ref Number to Track Complaint Status">
</div>
<div class="container">
    <% rows.sort((a, b) => new Date(b.created_at) - new Date(a.created_at)); %>
    <% rows.forEach(function(row) { %>
        <div class="dashboard-row status-<%= row.status %>" data-ref-number="<%= row.ref_number %>">
            <div class="dashboard-date"><%= new Date(row.created_at).toLocaleString() %></div>
            <div class="dashboard-location"><strong>Parking Location: <%= row.parking_area %></strong></div>
            <div class="dashboard-issue"><%= row.issue %></div>
            <!-- hi i'm file -->
            <% if (row.filename) { %>
                <div class="dashboard-image">
                    <img src="/uploads/<%= row.filename %>" alt="Complaint Image" width="200">
                </div>
            <% } %> 
            <div class="dashboard-status">Status: <%= row.status %></div>
        </div>
    <% }); %> 
</div>

<style>
    *{
        box-sizing: border-box;
    }
    .dashboard-row {
        background-color: #f8f8f8;
        margin: 70px auto -60px auto;
        display: flex;
        flex-direction: column; 
        align-items: flex-start;
        justify-content: center;
        border-radius: 5px;
        width: 80%;
        height: auto;
        padding: 12px;
        border: 2px solid #f8f8f8;
        font-size: 16px;
        transition: transform 0.2s, box-shadow 0.2s;

    }
    .dashboard-row:hover {
        transform: translateY(-5px); /* Slight lift effect on hover */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15); /* Enhance shadow on hover */
    }
    .dashboard-date {
        font-style: italic;
        margin-left: auto;
        font-size: 13px;
    }
    .dashboard-status {
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 16px;
    }
    
    .dashboard-location{
        font-weight: bold;
        padding: 5px 10px;
        border-radius: 20px;
    }
    .dashboard-issue {
        background-color: #f5f5f5;
        padding: 10px;
        border-radius: 5px;
        font-size: 13px;
        text-align: justify;
        width: 100%;
        position: relative;
    }
    .status-filter select {
        margin-left: 10px;
        background-color: #872698;  
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        font-size: 14px;
        width: 100px;
    }
    .search-track{
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .track-num{
        width: 80%;
        height: 30px;
        margin-top: 20px;
        border-radius: 4px;
        font-size: 10px;
    }

</style>

<script>
document.getElementById('complaintsBtn').addEventListener('click', function(){
    window.location.href = '/complaints';
});

document.getElementById('status-filter').addEventListener('change', function() {
    const selectedStatus = this.value;
    const complaintRows = document.querySelectorAll('.dashboard-row');

    complaintRows.forEach(row => {
        if (selectedStatus === 'all') {
            row.style.display = 'block';
        } else {
            if (row.classList.contains('status-' + selectedStatus)) {
                row.style.display = 'block';
            } else {
                row.style.display = 'none';
            }
        }
    });
});

// Listen for 'Enter' key in the search input
document.querySelector('.track-num').addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
        const searchValue = this.value.trim().toLowerCase();
        const complaintRows = document.querySelectorAll('.dashboard-row');

        complaintRows.forEach(row => {
            const refNumber = row.getAttribute('data-ref-number').trim().toLowerCase(); // Fixed attribute selector
            if (refNumber.includes(searchValue)) {
                row.style.display = 'block';
            } else {
                row.style.display = 'none';
            }
        });
    }
});
    
</script>
