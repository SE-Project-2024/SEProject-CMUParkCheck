<%- include("../partials/header") %>
<div class="parking-complaint-text">
    <div class="parking-complaint">PARKING COMPLAINTS</div>
    <div class="complaint-text">This form is to address concerns regarding parking situations, experiences, and facilities at Chiang Mai University.</div>
</div>
<form action="/upload" method="POST" enctype="multipart/form-data">
    <div class="location">
        <div class="location-text">LOCATION:</div>
        <!-- <input type="text" id="location" name="location" placeholder="Enter location" required> -->
    </div>

    <div class="issue">
        <div class="issue-text">ISSUE/CONCERNS:</div>
        <div class="input-issue-box">
            <textarea id="issue" name="issue" placeholder="Write something.." required></textarea>
        </div>
    </div>

    <div class="media-proof">
        <div class="media-proof-text">MEDIA PROOF:</div>
    </div>
    <div class="file-upload-container">
        <label for="myFile">
            <img src="/img/add-file.png" alt="Upload Image" class="file" />
        </label>
        <input type="file" id="myFile" name="filename[]" style="display: none;" multiple onchange="previewFiles()" />
        <div class="img" id="previewContainer"></div>
    </div>     
    
    <div class="img" id="previewContainer" style="display: none;">
        <span class="delete" onclick="removeFile()">&times;</span>
        <img id="previewImg" />
        <p id="fileName"></p>
    </div>
    
    <button type="submit" class="submit">Publish Complaint</button>
</form>

<script>
    let selectedFiles = [];
    
    function previewFiles() {
        const fileInput = document.getElementById("myFile");
        const files = Array.from(fileInput.files);
        const previewContainer = document.getElementById("previewContainer");
    
        selectedFiles = [...files]; 
    
        previewContainer.innerHTML = ""; 
    
        selectedFiles.forEach((file, index) => {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
    
                reader.onload = function(e) {
                    const imgContainer = document.createElement("div");
                    imgContainer.classList.add("img");
                    
                    const img = document.createElement("img");
                    img.src = e.target.result;
    
                    const deleteBtn = document.createElement("span");
                    deleteBtn.classList.add("delete");
                    deleteBtn.innerHTML = "&times;";
                    deleteBtn.onclick = function() {
                        removeFile(index); 
                    };
    
                    imgContainer.appendChild(img);
                    imgContainer.appendChild(deleteBtn);
                    previewContainer.appendChild(imgContainer);
                };
    
                reader.readAsDataURL(file);
            }
        });
    }

    function removeFile(index) {
        selectedFiles.splice(index, 1); 
        const fileInput = document.getElementById("myFile");
        const dt = new DataTransfer();
        selectedFiles.forEach(file => dt.items.add(file)); 
        fileInput.files = dt.files;
        previewFiles();
    }
    </script>
    